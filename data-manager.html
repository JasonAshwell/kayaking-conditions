<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kayaking Data Manager</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #0066cc 0%, #0052a3 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #e5e5e5;
            overflow-x: auto;
        }

        .tab {
            padding: 15px 25px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 1rem;
            font-weight: 600;
            color: #666;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .tab:hover {
            background: rgba(0, 102, 204, 0.1);
            color: #0066cc;
        }

        .tab.active {
            background: white;
            color: #0066cc;
            border-bottom: 3px solid #0066cc;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .form-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .form-section h3 {
            color: #0066cc;
            margin-bottom: 15px;
        }

        .form-row {
            margin-bottom: 15px;
        }

        .form-row label {
            display: block;
            font-weight: 600;
            margin-bottom: 5px;
            color: #333;
        }

        .form-row input,
        .form-row textarea,
        .form-row select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e5e5e5;
            border-radius: 6px;
            font-size: 1rem;
            font-family: inherit;
        }

        .form-row input:focus,
        .form-row textarea:focus,
        .form-row select:focus {
            outline: none;
            border-color: #0066cc;
        }

        .form-row textarea {
            min-height: 80px;
            resize: vertical;
        }

        .form-row small {
            display: block;
            margin-top: 5px;
            color: #666;
            font-size: 0.85rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #0066cc 0%, #0052a3 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 102, 204, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #218838 100%);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(220, 53, 69, 0.3);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .data-list {
            margin-top: 20px;
        }

        .data-item {
            background: white;
            border: 2px solid #e5e5e5;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .data-item:hover {
            border-color: #0066cc;
        }

        .data-item-info h4 {
            color: #0066cc;
            margin-bottom: 5px;
        }

        .data-item-info p {
            color: #666;
            font-size: 0.9rem;
        }

        .data-item-actions {
            display: flex;
            gap: 8px;
        }

        .data-item-actions button {
            padding: 8px 16px;
            font-size: 0.9rem;
        }

        .output-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .output-section h3 {
            color: #0066cc;
            margin-bottom: 15px;
        }

        .code-output {
            background: #2d2d2d;
            color: #f8f9fa;
            padding: 20px;
            border-radius: 6px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.5;
            max-height: 400px;
            overflow-y: auto;
        }

        .alert {
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .import-section {
            margin-bottom: 20px;
        }

        .import-section textarea {
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .tabs {
                flex-wrap: nowrap;
            }

            .data-item {
                flex-direction: column;
                align-items: flex-start;
            }

            .data-item-actions {
                margin-top: 10px;
                width: 100%;
            }

            .data-item-actions button {
                flex: 1;
            }

            .btn-actions {
                flex-direction: column;
            }

            .btn-actions button {
                width: 100%;
            }
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 5px;
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
            margin: 0;
        }

        .copy-btn {
            margin-top: 10px;
        }

        .map-preview {
            height: 300px;
            border: 2px solid #e5e5e5;
            border-radius: 6px;
            margin-top: 15px;
            margin-bottom: 15px;
        }

        .map-label {
            display: block;
            font-weight: 600;
            margin-bottom: 5px;
            color: #333;
        }

        .map-hint {
            font-size: 0.85rem;
            color: #666;
            margin-top: -3px;
            margin-bottom: 8px;
            font-style: italic;
        }

        .file-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }

        .file-input-wrapper input[type=file] {
            position: absolute;
            left: -9999px;
        }

        .btn-edit {
            background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%);
            color: white;
        }

        .btn-edit:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 193, 7, 0.3);
        }

        .form-mode-indicator {
            background: #fff3cd;
            border: 1px solid #ffc107;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 15px;
            display: none;
        }

        .form-mode-indicator.active {
            display: block;
        }

        .form-mode-indicator strong {
            color: #856404;
        }

        .quick-edit-section {
            background: #e8f5e9;
            border: 2px solid #28a745;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .quick-edit-section h4 {
            color: #1e7e34;
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .quick-edit-section select {
            width: 100%;
            padding: 10px;
            border: 2px solid #28a745;
            border-radius: 6px;
            font-size: 1rem;
            background: white;
            cursor: pointer;
        }

        .quick-edit-section select:focus {
            outline: none;
            border-color: #1e7e34;
        }

        .quick-edit-hint {
            font-size: 0.85rem;
            color: #2d5016;
            margin-top: 8px;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üõ∂ Kayaking Data Manager</h1>
            <p>Manage locations, routes, parking, and webcams with an easy-to-use interface</p>
        </div>

        <div class="tabs">
            <button class="tab active" data-tab="locations">üìç Locations</button>
            <button class="tab" data-tab="routes">üó∫Ô∏è Routes</button>
            <button class="tab" data-tab="parking">üÖøÔ∏è Parking</button>
            <button class="tab" data-tab="webcams">üìπ Webcams</button>
        </div>

        <!-- Locations Tab -->
        <div class="tab-content active" id="locations">
            <div class="alert alert-info">
                <strong>Manage Locations:</strong> Add your favorite kayaking spots with descriptions, coordinates, and images.
            </div>

            <div class="file-actions">
                <label class="file-input-wrapper btn btn-secondary">
                    üìÅ Import from File
                    <input type="file" accept=".js" onchange="importLocationsFile(event)">
                </label>
                <button class="btn btn-success" onclick="downloadLocationsFile()">üíæ Download File</button>
            </div>

            <div class="quick-edit-section">
                <h4>‚ö° Quick Edit</h4>
                <select id="location-quick-select" onchange="quickEditLocation()">
                    <option value="">-- Select a location to edit --</option>
                </select>
                <div class="quick-edit-hint">Select a location from the dropdown to quickly load it for editing</div>
            </div>

            <div class="form-section">
                <h3>Add/Edit Location</h3>
                <div class="form-mode-indicator" id="location-edit-mode">
                    <strong>‚úèÔ∏è Edit Mode:</strong> Updating existing location. <a href="#" onclick="cancelLocationEdit(); return false;">Cancel</a>
                </div>
                <form id="location-form">
                    <div class="form-row">
                        <label>Location Name *</label>
                        <input type="text" id="loc-name" required>
                        <small>e.g., "Dartmouth", "Salcombe"</small>
                    </div>

                    <div class="form-grid">
                        <div class="form-row">
                            <label>Latitude *</label>
                            <input type="number" step="any" id="loc-lat" required oninput="updateLocationMap()">
                            <small>e.g., 50.3515</small>
                        </div>
                        <div class="form-row">
                            <label>Longitude *</label>
                            <input type="number" step="any" id="loc-lon" required oninput="updateLocationMap()">
                            <small>e.g., -3.5794</small>
                        </div>
                    </div>

                    <div class="form-row">
                        <label class="map-label">üìç Map Preview</label>
                        <div class="map-hint">üí° Click anywhere on the map to drop a pin and set coordinates</div>
                        <div id="location-map" class="map-preview"></div>
                    </div>

                    <div class="form-row">
                        <label>Short Description</label>
                        <input type="text" id="loc-desc">
                        <small>Brief description for dropdown (optional)</small>
                    </div>

                    <div class="form-row">
                        <label>Paddling Description</label>
                        <textarea id="loc-paddling-desc"></textarea>
                        <small>Detailed paddling information (optional)</small>
                    </div>

                    <div class="form-row">
                        <label>Image Paths (one per line)</label>
                        <textarea id="loc-images"></textarea>
                        <small>e.g., images/locations/dartmouth/dartmouth-1.jpg</small>
                    </div>

                    <div class="btn-actions">
                        <button type="submit" class="btn btn-primary" id="location-submit-btn">Add Location</button>
                        <button type="button" class="btn btn-secondary" onclick="clearLocationForm()">Clear Form</button>
                    </div>
                </form>
            </div>

            <div class="data-list" id="locations-list"></div>

            <div class="output-section">
                <h3>Generated Code for locations.js</h3>
                <button class="btn btn-success copy-btn" onclick="copyToClipboard('locations-output')">üìã Copy to Clipboard</button>
                <pre class="code-output" id="locations-output"></pre>
            </div>
        </div>

        <!-- Routes Tab -->
        <div class="tab-content" id="routes">
            <div class="alert alert-info">
                <strong>Manage Routes:</strong> Add kayaking routes from Strava, Outdoor Active, or custom sources.
            </div>

            <div class="file-actions">
                <label class="file-input-wrapper btn btn-secondary">
                    üìÅ Import from File
                    <input type="file" accept=".js" onchange="importRoutesFile(event)">
                </label>
                <button class="btn btn-success" onclick="downloadRoutesFile()">üíæ Download File</button>
            </div>

            <div class="quick-edit-section">
                <h4>‚ö° Quick Edit</h4>
                <select id="route-quick-select" onchange="quickEditRoute()">
                    <option value="">-- Select a route to edit --</option>
                </select>
                <div class="quick-edit-hint">Select a route from the dropdown to quickly load it for editing</div>
            </div>

            <div class="form-section">
                <h3>Add/Edit Route</h3>
                <div class="form-mode-indicator" id="route-edit-mode">
                    <strong>‚úèÔ∏è Edit Mode:</strong> Updating existing route. <a href="#" onclick="cancelRouteEdit(); return false;">Cancel</a>
                </div>
                <form id="route-form">
                    <div class="form-row">
                        <label>Route Name *</label>
                        <input type="text" id="route-name" required>
                        <small>e.g., "Dartmouth to The Mew Stone"</small>
                    </div>

                    <div class="form-grid">
                        <div class="form-row">
                            <label>Latitude *</label>
                            <input type="number" step="any" id="route-lat" required oninput="updateRouteMap()">
                        </div>
                        <div class="form-row">
                            <label>Longitude *</label>
                            <input type="number" step="any" id="route-lon" required oninput="updateRouteMap()">
                        </div>
                    </div>

                    <div class="form-row">
                        <label class="map-label">üìç Map Preview</label>
                        <div class="map-hint">üí° Click anywhere on the map to drop a pin and set coordinates</div>
                        <div id="route-map" class="map-preview"></div>
                    </div>

                    <div class="form-grid">
                        <div class="form-row">
                            <label>Route URL *</label>
                            <input type="url" id="route-url" required>
                            <small>Strava, Outdoor Active, or other link</small>
                        </div>
                        <div class="form-row">
                            <label>Platform Type *</label>
                            <select id="route-type" required>
                                <option value="strava">Strava</option>
                                <option value="outdooractive">Outdoor Active</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <label>Description</label>
                        <textarea id="route-description"></textarea>
                    </div>

                    <div class="form-grid">
                        <div class="form-row">
                            <label>Distance</label>
                            <input type="text" id="route-distance">
                            <small>e.g., "12km" or "7.5 miles"</small>
                        </div>
                        <div class="form-row">
                            <label>Difficulty</label>
                            <select id="route-difficulty">
                                <option value="">-- Not specified --</option>
                                <option value="Easy">Easy</option>
                                <option value="Moderate">Moderate</option>
                                <option value="Intermediate">Intermediate</option>
                                <option value="Advanced">Advanced</option>
                                <option value="Extreme">Extreme</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <label>‚úÖ Good Conditions</label>
                        <textarea id="route-good-conditions"></textarea>
                        <small>When is this route best to paddle?</small>
                    </div>

                    <div class="form-row">
                        <label>‚ö†Ô∏è Tricky Conditions</label>
                        <textarea id="route-tricky-conditions"></textarea>
                        <small>What conditions should be avoided?</small>
                    </div>

                    <div class="btn-actions">
                        <button type="submit" class="btn btn-primary" id="route-submit-btn">Add Route</button>
                        <button type="button" class="btn btn-secondary" onclick="clearRouteForm()">Clear Form</button>
                    </div>
                </form>
            </div>

            <div class="data-list" id="routes-list"></div>

            <div class="output-section">
                <h3>Generated Code for routes.js</h3>
                <button class="btn btn-success copy-btn" onclick="copyToClipboard('routes-output')">üìã Copy to Clipboard</button>
                <pre class="code-output" id="routes-output"></pre>
            </div>
        </div>

        <!-- Parking Tab -->
        <div class="tab-content" id="parking">
            <div class="alert alert-info">
                <strong>Manage Parking:</strong> Add custom parking locations near kayaking spots.
            </div>

            <div class="file-actions">
                <label class="file-input-wrapper btn btn-secondary">
                    üìÅ Import from File
                    <input type="file" accept=".js" onchange="importParkingFile(event)">
                </label>
                <button class="btn btn-success" onclick="downloadParkingFile()">üíæ Download File</button>
            </div>

            <div class="quick-edit-section">
                <h4>‚ö° Quick Edit</h4>
                <select id="parking-quick-select" onchange="quickEditParking()">
                    <option value="">-- Select a parking location to edit --</option>
                </select>
                <div class="quick-edit-hint">Select a parking location from the dropdown to quickly load it for editing</div>
            </div>

            <div class="form-section">
                <h3>Add/Edit Parking</h3>
                <div class="form-mode-indicator" id="parking-edit-mode">
                    <strong>‚úèÔ∏è Edit Mode:</strong> Updating existing parking. <a href="#" onclick="cancelParkingEdit(); return false;">Cancel</a>
                </div>
                <form id="parking-form">
                    <div class="form-row">
                        <label>Parking Name *</label>
                        <input type="text" id="park-name" required>
                        <small>e.g., "Bigbury Beach Car Park"</small>
                    </div>

                    <div class="form-grid">
                        <div class="form-row">
                            <label>Latitude *</label>
                            <input type="number" step="any" id="park-lat" required oninput="updateParkingMap()">
                        </div>
                        <div class="form-row">
                            <label>Longitude *</label>
                            <input type="number" step="any" id="park-lon" required oninput="updateParkingMap()">
                        </div>
                    </div>

                    <div class="form-row">
                        <label class="map-label">üìç Map Preview</label>
                        <div class="map-hint">üí° Click anywhere on the map to drop a pin and set coordinates</div>
                        <div id="parking-map" class="map-preview"></div>
                    </div>

                    <div class="form-row">
                        <label>Description</label>
                        <textarea id="park-description"></textarea>
                        <small>Include fees, capacity, restrictions, etc.</small>
                    </div>

                    <div class="form-row">
                        <label>Parking Type</label>
                        <select id="park-type">
                            <option value="">-- Not specified --</option>
                            <option value="Free">Free</option>
                            <option value="Pay & Display">Pay & Display</option>
                            <option value="Permit Only">Permit Only</option>
                            <option value="Limited">Time Limited</option>
                            <option value="Disabled">Disabled Only</option>
                            <option value="Informal">Informal/Roadside</option>
                        </select>
                    </div>

                    <div class="btn-actions">
                        <button type="submit" class="btn btn-primary" id="parking-submit-btn">Add Parking</button>
                        <button type="button" class="btn btn-secondary" onclick="clearParkingForm()">Clear Form</button>
                    </div>
                </form>
            </div>

            <div class="data-list" id="parking-list"></div>

            <div class="output-section">
                <h3>Generated Code for parking.js</h3>
                <button class="btn btn-success copy-btn" onclick="copyToClipboard('parking-output')">üìã Copy to Clipboard</button>
                <pre class="code-output" id="parking-output"></pre>
            </div>
        </div>

        <!-- Webcams Tab -->
        <div class="tab-content" id="webcams">
            <div class="alert alert-info">
                <strong>Manage Webcams:</strong> Add webcam links for live views near kayaking locations.
            </div>

            <div class="file-actions">
                <label class="file-input-wrapper btn btn-secondary">
                    üìÅ Import from File
                    <input type="file" accept=".js" onchange="importWebcamsFile(event)">
                </label>
                <button class="btn btn-success" onclick="downloadWebcamsFile()">üíæ Download File</button>
            </div>

            <div class="quick-edit-section">
                <h4>‚ö° Quick Edit</h4>
                <select id="webcam-quick-select" onchange="quickEditWebcam()">
                    <option value="">-- Select a webcam to edit --</option>
                </select>
                <div class="quick-edit-hint">Select a webcam from the dropdown to quickly load it for editing</div>
            </div>

            <div class="form-section">
                <h3>Add/Edit Webcam</h3>
                <div class="form-mode-indicator" id="webcam-edit-mode">
                    <strong>‚úèÔ∏è Edit Mode:</strong> Updating existing webcam. <a href="#" onclick="cancelWebcamEdit(); return false;">Cancel</a>
                </div>
                <form id="webcam-form">
                    <div class="form-row">
                        <label>Webcam Name *</label>
                        <input type="text" id="cam-name" required>
                        <small>e.g., "Bigbury Beach Webcam"</small>
                    </div>

                    <div class="form-grid">
                        <div class="form-row">
                            <label>Latitude *</label>
                            <input type="number" step="any" id="cam-lat" required oninput="updateWebcamMap()">
                        </div>
                        <div class="form-row">
                            <label>Longitude *</label>
                            <input type="number" step="any" id="cam-lon" required oninput="updateWebcamMap()">
                        </div>
                    </div>

                    <div class="form-row">
                        <label class="map-label">üìç Map Preview</label>
                        <div class="map-hint">üí° Click anywhere on the map to drop a pin and set coordinates</div>
                        <div id="webcam-map" class="map-preview"></div>
                    </div>

                    <div class="form-grid">
                        <div class="form-row">
                            <label>Webcam URL *</label>
                            <input type="url" id="cam-url" required>
                        </div>
                        <div class="form-row">
                            <label>Type *</label>
                            <select id="cam-type" required>
                                <option value="image">Image</option>
                                <option value="iframe">Iframe</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <label>Display Mode *</label>
                        <select id="cam-display" required>
                            <option value="embed">Embed in App</option>
                            <option value="newtab">Open in New Tab</option>
                        </select>
                    </div>

                    <div class="btn-actions">
                        <button type="submit" class="btn btn-primary" id="webcam-submit-btn">Add Webcam</button>
                        <button type="button" class="btn btn-secondary" onclick="clearWebcamForm()">Clear Form</button>
                    </div>
                </form>
            </div>

            <div class="data-list" id="webcams-list"></div>

            <div class="output-section">
                <h3>Generated Code for webcams.js</h3>
                <button class="btn btn-success copy-btn" onclick="copyToClipboard('webcams-output')">üìã Copy to Clipboard</button>
                <pre class="code-output" id="webcams-output"></pre>
            </div>
        </div>
    </div>

    <script>
        // Data storage
        let locations = [];
        let routes = [];
        let parking = [];
        let webcams = [];

        // Load data from localStorage
        function loadData() {
            locations = JSON.parse(localStorage.getItem('kayaking_locations') || '[]');
            routes = JSON.parse(localStorage.getItem('kayaking_routes') || '[]');
            parking = JSON.parse(localStorage.getItem('kayaking_parking') || '[]');
            webcams = JSON.parse(localStorage.getItem('kayaking_webcams') || '[]');

            renderAllLists();
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('kayaking_locations', JSON.stringify(locations));
            localStorage.setItem('kayaking_routes', JSON.stringify(routes));
            localStorage.setItem('kayaking_parking', JSON.stringify(parking));
            localStorage.setItem('kayaking_webcams', JSON.stringify(webcams));
        }

        // Tab switching
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                const tabName = tab.dataset.tab;

                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

                tab.classList.add('active');
                document.getElementById(tabName).classList.add('active');
            });
        });

        function clearLocationForm() {
            document.getElementById('location-form').reset();
        }

        function renderLocationsList() {
            const list = document.getElementById('locations-list');
            list.innerHTML = '<h3>Saved Locations (' + locations.length + ')</h3>';

            locations.forEach((loc, index) => {
                const div = document.createElement('div');
                div.className = 'data-item';
                div.innerHTML = `
                    <div class="data-item-info">
                        <h4>${loc.name}</h4>
                        <p>Lat: ${loc.lat}, Lon: ${loc.lon}</p>
                        ${loc.description ? `<p>${loc.description}</p>` : ''}
                    </div>
                    <div class="data-item-actions">
                        <button class="btn btn-edit" onclick="editLocation(${index})">Edit</button>
                        <button class="btn btn-danger" onclick="deleteLocation(${index})">Delete</button>
                    </div>
                `;
                list.appendChild(div);
            });

            // Update quick-select dropdown
            updateLocationQuickSelect();
        }

        function updateLocationQuickSelect() {
            const select = document.getElementById('location-quick-select');
            select.innerHTML = '<option value="">-- Select a location to edit --</option>';

            locations.forEach((loc, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = loc.name + ' (' + loc.lat.toFixed(4) + ', ' + loc.lon.toFixed(4) + ')';
                select.appendChild(option);
            });
        }

        function quickEditLocation() {
            const select = document.getElementById('location-quick-select');
            const index = parseInt(select.value);
            if (!isNaN(index)) {
                editLocation(index);
            }
        }

        function deleteLocation(index) {
            if (confirm('Delete this location?')) {
                locations.splice(index, 1);
                saveData();
                renderLocationsList();
                generateLocationsCode();
            }
        }

        function generateLocationsCode() {
            const code = `const SAVED_LOCATIONS = ${JSON.stringify(locations, null, 4)};`;
            document.getElementById('locations-output').textContent = code;
        }

        function clearRouteForm() {
            document.getElementById('route-form').reset();
        }

        function renderRoutesList() {
            const list = document.getElementById('routes-list');
            list.innerHTML = '<h3>Saved Routes (' + routes.length + ')</h3>';

            routes.forEach((route, index) => {
                const div = document.createElement('div');
                div.className = 'data-item';
                div.innerHTML = `
                    <div class="data-item-info">
                        <h4>${route.name}</h4>
                        <p>${route.distance || 'Distance not specified'} - ${route.difficulty || 'Difficulty not specified'}</p>
                        <p>Lat: ${route.lat}, Lon: ${route.lon}</p>
                    </div>
                    <div class="data-item-actions">
                        <button class="btn btn-edit" onclick="editRoute(${index})">Edit</button>
                        <button class="btn btn-danger" onclick="deleteRoute(${index})">Delete</button>
                    </div>
                `;
                list.appendChild(div);
            });

            // Update quick-select dropdown
            updateRouteQuickSelect();
        }

        function updateRouteQuickSelect() {
            const select = document.getElementById('route-quick-select');
            select.innerHTML = '<option value="">-- Select a route to edit --</option>';

            routes.forEach((route, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = route.name + ' - ' + (route.distance || 'No distance');
                select.appendChild(option);
            });
        }

        function quickEditRoute() {
            const select = document.getElementById('route-quick-select');
            const index = parseInt(select.value);
            if (!isNaN(index)) {
                editRoute(index);
            }
        }

        function deleteRoute(index) {
            if (confirm('Delete this route?')) {
                routes.splice(index, 1);
                saveData();
                renderRoutesList();
                generateRoutesCode();
            }
        }

        function generateRoutesCode() {
            const code = `const KAYAKING_ROUTES = ${JSON.stringify(routes, null, 4)};`;
            document.getElementById('routes-output').textContent = code;
        }

        function clearParkingForm() {
            document.getElementById('parking-form').reset();
        }

        function renderParkingList() {
            const list = document.getElementById('parking-list');
            list.innerHTML = '<h3>Saved Parking (' + parking.length + ')</h3>';

            parking.forEach((park, index) => {
                const div = document.createElement('div');
                div.className = 'data-item';
                div.innerHTML = `
                    <div class="data-item-info">
                        <h4>${park.name}</h4>
                        <p>${park.type || 'Type not specified'}</p>
                        <p>Lat: ${park.lat}, Lon: ${park.lon}</p>
                    </div>
                    <div class="data-item-actions">
                        <button class="btn btn-edit" onclick="editParking(${index})">Edit</button>
                        <button class="btn btn-danger" onclick="deleteParking(${index})">Delete</button>
                    </div>
                `;
                list.appendChild(div);
            });

            // Update quick-select dropdown
            updateParkingQuickSelect();
        }

        function updateParkingQuickSelect() {
            const select = document.getElementById('parking-quick-select');
            select.innerHTML = '<option value="">-- Select a parking location to edit --</option>';

            parking.forEach((park, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = park.name + ' - ' + (park.type || 'Type not specified');
                select.appendChild(option);
            });
        }

        function quickEditParking() {
            const select = document.getElementById('parking-quick-select');
            const index = parseInt(select.value);
            if (!isNaN(index)) {
                editParking(index);
            }
        }

        function deleteParking(index) {
            if (confirm('Delete this parking location?')) {
                parking.splice(index, 1);
                saveData();
                renderParkingList();
                generateParkingCode();
            }
        }

        function generateParkingCode() {
            const code = `const CUSTOM_PARKING = ${JSON.stringify(parking, null, 4)};`;
            document.getElementById('parking-output').textContent = code;
        }

        function clearWebcamForm() {
            document.getElementById('webcam-form').reset();
        }

        function renderWebcamsList() {
            const list = document.getElementById('webcams-list');
            list.innerHTML = '<h3>Saved Webcams (' + webcams.length + ')</h3>';

            webcams.forEach((cam, index) => {
                const div = document.createElement('div');
                div.className = 'data-item';
                div.innerHTML = `
                    <div class="data-item-info">
                        <h4>${cam.name}</h4>
                        <p>${cam.type} - ${cam.display === 'embed' ? 'Embedded' : 'New Tab'}</p>
                        <p>Lat: ${cam.lat}, Lon: ${cam.lon}</p>
                    </div>
                    <div class="data-item-actions">
                        <button class="btn btn-edit" onclick="editWebcam(${index})">Edit</button>
                        <button class="btn btn-danger" onclick="deleteWebcam(${index})">Delete</button>
                    </div>
                `;
                list.appendChild(div);
            });

            // Update quick-select dropdown
            updateWebcamQuickSelect();
        }

        function updateWebcamQuickSelect() {
            const select = document.getElementById('webcam-quick-select');
            select.innerHTML = '<option value="">-- Select a webcam to edit --</option>';

            webcams.forEach((cam, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = cam.name + ' - ' + cam.type;
                select.appendChild(option);
            });
        }

        function quickEditWebcam() {
            const select = document.getElementById('webcam-quick-select');
            const index = parseInt(select.value);
            if (!isNaN(index)) {
                editWebcam(index);
            }
        }

        function deleteWebcam(index) {
            if (confirm('Delete this webcam?')) {
                webcams.splice(index, 1);
                saveData();
                renderWebcamsList();
                generateWebcamsCode();
            }
        }

        function generateWebcamsCode() {
            const code = `const WEBCAMS = ${JSON.stringify(webcams, null, 4)};`;
            document.getElementById('webcams-output').textContent = code;
        }

        // Render all lists
        function renderAllLists() {
            renderLocationsList();
            renderRoutesList();
            renderParkingList();
            renderWebcamsList();
            generateLocationsCode();
            generateRoutesCode();
            generateParkingCode();
            generateWebcamsCode();
        }

        // Copy to clipboard
        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            const text = element.textContent;

            navigator.clipboard.writeText(text).then(() => {
                alert('Code copied to clipboard! Paste it into your data file.');
            }).catch(err => {
                console.error('Failed to copy:', err);
                alert('Failed to copy. Please select and copy manually.');
            });
        }

        // Edit mode tracking
        let editingLocation = -1;
        let editingRoute = -1;
        let editingParking = -1;
        let editingWebcam = -1;

        // Maps for coordinate preview
        let locationMap, routeMap, parkingMap, webcamMap;
        let locationMarker, routeMarker, parkingMarker, webcamMarker;

        // === EDIT FUNCTIONS ===

        function editLocation(index) {
            editingLocation = index;
            const loc = locations[index];

            document.getElementById('loc-name').value = loc.name;
            document.getElementById('loc-lat').value = loc.lat;
            document.getElementById('loc-lon').value = loc.lon;
            document.getElementById('loc-desc').value = loc.description || '';
            document.getElementById('loc-paddling-desc').value = loc.paddlingDescription || '';
            document.getElementById('loc-images').value = loc.images ? loc.images.join('\n') : '';

            document.getElementById('location-submit-btn').textContent = 'Update Location';
            document.getElementById('location-edit-mode').classList.add('active');

            updateLocationMap();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function cancelLocationEdit() {
            editingLocation = -1;
            clearLocationForm();
            document.getElementById('location-submit-btn').textContent = 'Add Location';
            document.getElementById('location-edit-mode').classList.remove('active');
            document.getElementById('location-quick-select').value = '';
        }

        function editRoute(index) {
            editingRoute = index;
            const route = routes[index];

            document.getElementById('route-name').value = route.name;
            document.getElementById('route-lat').value = route.lat;
            document.getElementById('route-lon').value = route.lon;
            document.getElementById('route-url').value = route.url;
            document.getElementById('route-type').value = route.type;
            document.getElementById('route-description').value = route.description || '';
            document.getElementById('route-distance').value = route.distance || '';
            document.getElementById('route-difficulty').value = route.difficulty || '';
            document.getElementById('route-good-conditions').value = route.goodConditions || '';
            document.getElementById('route-tricky-conditions').value = route.trickyConditions || '';

            document.getElementById('route-submit-btn').textContent = 'Update Route';
            document.getElementById('route-edit-mode').classList.add('active');

            updateRouteMap();

            // Switch to routes tab
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelector('[data-tab="routes"]').classList.add('active');
            document.getElementById('routes').classList.add('active');

            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function cancelRouteEdit() {
            editingRoute = -1;
            clearRouteForm();
            document.getElementById('route-submit-btn').textContent = 'Add Route';
            document.getElementById('route-edit-mode').classList.remove('active');
            document.getElementById('route-quick-select').value = '';
        }

        function editParking(index) {
            editingParking = index;
            const park = parking[index];

            document.getElementById('park-name').value = park.name;
            document.getElementById('park-lat').value = park.lat;
            document.getElementById('park-lon').value = park.lon;
            document.getElementById('park-description').value = park.description || '';
            document.getElementById('park-type').value = park.type || '';

            document.getElementById('parking-submit-btn').textContent = 'Update Parking';
            document.getElementById('parking-edit-mode').classList.add('active');

            updateParkingMap();

            // Switch to parking tab
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelector('[data-tab="parking"]').classList.add('active');
            document.getElementById('parking').classList.add('active');

            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function cancelParkingEdit() {
            editingParking = -1;
            clearParkingForm();
            document.getElementById('parking-submit-btn').textContent = 'Add Parking';
            document.getElementById('parking-edit-mode').classList.remove('active');
            document.getElementById('parking-quick-select').value = '';
        }

        function editWebcam(index) {
            editingWebcam = index;
            const cam = webcams[index];

            document.getElementById('cam-name').value = cam.name;
            document.getElementById('cam-lat').value = cam.lat;
            document.getElementById('cam-lon').value = cam.lon;
            document.getElementById('cam-url').value = cam.url;
            document.getElementById('cam-type').value = cam.type;
            document.getElementById('cam-display').value = cam.display;

            document.getElementById('webcam-submit-btn').textContent = 'Update Webcam';
            document.getElementById('webcam-edit-mode').classList.add('active');

            updateWebcamMap();

            // Switch to webcams tab
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelector('[data-tab="webcams"]').classList.add('active');
            document.getElementById('webcams').classList.add('active');

            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function cancelWebcamEdit() {
            editingWebcam = -1;
            clearWebcamForm();
            document.getElementById('webcam-submit-btn').textContent = 'Add Webcam';
            document.getElementById('webcam-edit-mode').classList.remove('active');
            document.getElementById('webcam-quick-select').value = '';
        }

        // === MAP PREVIEW FUNCTIONS ===

        function initMaps() {
            // Initialize location map
            locationMap = L.map('location-map').setView([50.3515, -3.5794], 10);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors'
            }).addTo(locationMap);
            locationMarker = L.marker([50.3515, -3.5794]).addTo(locationMap);

            // Click to set coordinates
            locationMap.on('click', function(e) {
                const lat = e.latlng.lat.toFixed(6);
                const lon = e.latlng.lng.toFixed(6);
                document.getElementById('loc-lat').value = lat;
                document.getElementById('loc-lon').value = lon;
                locationMarker.setLatLng([lat, lon]);
            });

            // Initialize route map
            routeMap = L.map('route-map').setView([50.3515, -3.5794], 10);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors'
            }).addTo(routeMap);
            routeMarker = L.marker([50.3515, -3.5794]).addTo(routeMap);

            // Click to set coordinates
            routeMap.on('click', function(e) {
                const lat = e.latlng.lat.toFixed(6);
                const lon = e.latlng.lng.toFixed(6);
                document.getElementById('route-lat').value = lat;
                document.getElementById('route-lon').value = lon;
                routeMarker.setLatLng([lat, lon]);
            });

            // Initialize parking map
            parkingMap = L.map('parking-map').setView([50.3515, -3.5794], 10);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors'
            }).addTo(parkingMap);
            parkingMarker = L.marker([50.3515, -3.5794]).addTo(parkingMap);

            // Click to set coordinates
            parkingMap.on('click', function(e) {
                const lat = e.latlng.lat.toFixed(6);
                const lon = e.latlng.lng.toFixed(6);
                document.getElementById('park-lat').value = lat;
                document.getElementById('park-lon').value = lon;
                parkingMarker.setLatLng([lat, lon]);
            });

            // Initialize webcam map
            webcamMap = L.map('webcam-map').setView([50.3515, -3.5794], 10);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors'
            }).addTo(webcamMap);
            webcamMarker = L.marker([50.3515, -3.5794]).addTo(webcamMap);

            // Click to set coordinates
            webcamMap.on('click', function(e) {
                const lat = e.latlng.lat.toFixed(6);
                const lon = e.latlng.lng.toFixed(6);
                document.getElementById('cam-lat').value = lat;
                document.getElementById('cam-lon').value = lon;
                webcamMarker.setLatLng([lat, lon]);
            });
        }

        function updateLocationMap() {
            const lat = parseFloat(document.getElementById('loc-lat').value);
            const lon = parseFloat(document.getElementById('loc-lon').value);

            if (!isNaN(lat) && !isNaN(lon) && lat >= -90 && lat <= 90 && lon >= -180 && lon <= 180) {
                locationMarker.setLatLng([lat, lon]);
                locationMap.setView([lat, lon], 13);
            }
        }

        function updateRouteMap() {
            const lat = parseFloat(document.getElementById('route-lat').value);
            const lon = parseFloat(document.getElementById('route-lon').value);

            if (!isNaN(lat) && !isNaN(lon) && lat >= -90 && lat <= 90 && lon >= -180 && lon <= 180) {
                routeMarker.setLatLng([lat, lon]);
                routeMap.setView([lat, lon], 13);
            }
        }

        function updateParkingMap() {
            const lat = parseFloat(document.getElementById('park-lat').value);
            const lon = parseFloat(document.getElementById('park-lon').value);

            if (!isNaN(lat) && !isNaN(lon) && lat >= -90 && lat <= 90 && lon >= -180 && lon <= 180) {
                parkingMarker.setLatLng([lat, lon]);
                parkingMap.setView([lat, lon], 13);
            }
        }

        function updateWebcamMap() {
            const lat = parseFloat(document.getElementById('cam-lat').value);
            const lon = parseFloat(document.getElementById('cam-lon').value);

            if (!isNaN(lat) && !isNaN(lon) && lat >= -90 && lat <= 90 && lon >= -180 && lon <= 180) {
                webcamMarker.setLatLng([lat, lon]);
                webcamMap.setView([lat, lon], 13);
            }
        }

        // === FILE IMPORT/EXPORT FUNCTIONS ===

        function downloadLocationsFile() {
            const code = `const SAVED_LOCATIONS = ${JSON.stringify(locations, null, 4)};`;
            downloadFile(code, 'locations.js');
        }

        function downloadRoutesFile() {
            const code = `const KAYAKING_ROUTES = ${JSON.stringify(routes, null, 4)};`;
            downloadFile(code, 'routes.js');
        }

        function downloadParkingFile() {
            const code = `const CUSTOM_PARKING = ${JSON.stringify(parking, null, 4)};`;
            downloadFile(code, 'parking.js');
        }

        function downloadWebcamsFile() {
            const code = `const WEBCAMS = ${JSON.stringify(webcams, null, 4)};`;
            downloadFile(code, 'webcams.js');
        }

        function downloadFile(content, filename) {
            const blob = new Blob([content], { type: 'text/javascript' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
        }

        function importLocationsFile(event) {
            importFile(event, (data) => {
                locations = data;
                saveData();
                renderLocationsList();
                generateLocationsCode();
                alert('Locations imported successfully!');
            }, 'SAVED_LOCATIONS');
        }

        function importRoutesFile(event) {
            importFile(event, (data) => {
                routes = data;
                saveData();
                renderRoutesList();
                generateRoutesCode();
                alert('Routes imported successfully!');
            }, 'KAYAKING_ROUTES');
        }

        function importParkingFile(event) {
            importFile(event, (data) => {
                parking = data;
                saveData();
                renderParkingList();
                generateParkingCode();
                alert('Parking locations imported successfully!');
            }, 'CUSTOM_PARKING');
        }

        function importWebcamsFile(event) {
            importFile(event, (data) => {
                webcams = data;
                saveData();
                renderWebcamsList();
                generateWebcamsCode();
                alert('Webcams imported successfully!');
            }, 'WEBCAMS');
        }

        function importFile(event, callback, variableName) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const content = e.target.result;

                    // Extract array from JavaScript file
                    const regex = new RegExp(`const\\s+${variableName}\\s*=\\s*(\\[[\\s\\S]*?\\]);`, 'm');
                    const match = content.match(regex);

                    if (match && match[1]) {
                        let arrayString = match[1];

                        // Remove JavaScript comments
                        // Remove single-line comments
                        arrayString = arrayString.replace(/\/\/.*$/gm, '');
                        // Remove multi-line comments
                        arrayString = arrayString.replace(/\/\*[\s\S]*?\*\//g, '');

                        // Try to parse as JSON
                        const data = JSON.parse(arrayString);
                        if (Array.isArray(data)) {
                            if (confirm(`Import ${data.length} items? This will replace your current data.`)) {
                                callback(data);
                            }
                        } else {
                            alert('Invalid file format: data is not an array');
                        }
                    } else {
                        alert(`Could not find ${variableName} in the file`);
                    }
                } catch (error) {
                    console.error('Import error:', error);
                    alert('Error reading file: ' + error.message + '\n\nThe file may contain invalid JavaScript syntax or comments that cannot be parsed.');
                }
            };
            reader.readAsText(file);

            // Reset input to allow re-importing the same file
            event.target.value = '';
        }

        // Update form submit handlers to support edit mode

        // Location form handler
        const originalLocationHandler = document.getElementById('location-form').onsubmit;
        document.getElementById('location-form').addEventListener('submit', (e) => {
            e.preventDefault();

            const location = {
                name: document.getElementById('loc-name').value,
                lat: parseFloat(document.getElementById('loc-lat').value),
                lon: parseFloat(document.getElementById('loc-lon').value),
                description: document.getElementById('loc-desc').value || undefined,
                paddlingDescription: document.getElementById('loc-paddling-desc').value || undefined,
                images: document.getElementById('loc-images').value
                    .split('\n')
                    .map(s => s.trim())
                    .filter(s => s)
            };

            if (location.images.length === 0) delete location.images;

            if (editingLocation >= 0) {
                // Update existing
                locations[editingLocation] = location;
                cancelLocationEdit();
                alert('Location updated successfully!');
            } else {
                // Add new
                locations.push(location);
                alert('Location added successfully!');
            }

            saveData();
            renderLocationsList();
            generateLocationsCode();
            clearLocationForm();
        });

        // Route form handler
        document.getElementById('route-form').addEventListener('submit', (e) => {
            e.preventDefault();

            const route = {
                name: document.getElementById('route-name').value,
                lat: parseFloat(document.getElementById('route-lat').value),
                lon: parseFloat(document.getElementById('route-lon').value),
                url: document.getElementById('route-url').value,
                type: document.getElementById('route-type').value,
                description: document.getElementById('route-description').value || undefined,
                distance: document.getElementById('route-distance').value || undefined,
                difficulty: document.getElementById('route-difficulty').value || undefined,
                goodConditions: document.getElementById('route-good-conditions').value || undefined,
                trickyConditions: document.getElementById('route-tricky-conditions').value || undefined
            };

            if (editingRoute >= 0) {
                // Update existing
                routes[editingRoute] = route;
                cancelRouteEdit();
                alert('Route updated successfully!');
            } else {
                // Add new
                routes.push(route);
                alert('Route added successfully!');
            }

            saveData();
            renderRoutesList();
            generateRoutesCode();
            clearRouteForm();
        });

        // Parking form handler
        document.getElementById('parking-form').addEventListener('submit', (e) => {
            e.preventDefault();

            const park = {
                name: document.getElementById('park-name').value,
                lat: parseFloat(document.getElementById('park-lat').value),
                lon: parseFloat(document.getElementById('park-lon').value),
                description: document.getElementById('park-description').value || undefined,
                type: document.getElementById('park-type').value || undefined
            };

            if (editingParking >= 0) {
                // Update existing
                parking[editingParking] = park;
                cancelParkingEdit();
                alert('Parking location updated successfully!');
            } else {
                // Add new
                parking.push(park);
                alert('Parking location added successfully!');
            }

            saveData();
            renderParkingList();
            generateParkingCode();
            clearParkingForm();
        });

        // Webcam form handler
        document.getElementById('webcam-form').addEventListener('submit', (e) => {
            e.preventDefault();

            const webcam = {
                name: document.getElementById('cam-name').value,
                lat: parseFloat(document.getElementById('cam-lat').value),
                lon: parseFloat(document.getElementById('cam-lon').value),
                url: document.getElementById('cam-url').value,
                type: document.getElementById('cam-type').value,
                display: document.getElementById('cam-display').value
            };

            if (editingWebcam >= 0) {
                // Update existing
                webcams[editingWebcam] = webcam;
                cancelWebcamEdit();
                alert('Webcam updated successfully!');
            } else {
                // Add new
                webcams.push(webcam);
                alert('Webcam added successfully!');
            }

            saveData();
            renderWebcamsList();
            generateWebcamsCode();
            clearWebcamForm();
        });

        // Initialize on load
        loadData();

        // Initialize maps after a short delay to ensure DOM is ready
        setTimeout(() => {
            initMaps();
            // Also ensure dropdowns are populated
            updateLocationQuickSelect();
            updateRouteQuickSelect();
            updateParkingQuickSelect();
            updateWebcamQuickSelect();
        }, 100);
    </script>
</body>
</html>
